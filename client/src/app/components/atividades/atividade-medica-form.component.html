<h2>{{ id ? 'Editar' : 'Nova' }} Atividade Médica</h2>

<div *ngIf="false" style="background: #f0f0f0; padding: 10px; margin-bottom: 20px;">
  <h4>Debug Info:</h4>
  <p>Pacientes: {{ pacientes.length }}</p>
  <p>Médicos: {{ medicosList.length }}</p>
  <p>Form válido: {{ form.valid }}</p>
  <p>Form errors: {{ form.errors | json }}</p>
</div>

<form [formGroup]="form" (ngSubmit)="salvar()">
  <div>
    <label>Início:
      <input type="datetime-local" formControlName="inicio">
    </label>
    <div *ngIf="form.get('inicio')?.invalid && form.get('inicio')?.touched" style="color: red;">
      Início é obrigatório
    </div>
  </div>

  <div>
    <label>Término:
      <input type="datetime-local" formControlName="termino">
    </label>
  </div>

  <div>
    <label>Tipo:
      <select formControlName="tipoAtividade">
        <option value="Consulta">Consulta</option>
        <option value="Cirurgia">Cirurgia</option>
      </select>
    </label>
  </div>

  <div>
    <label>Paciente:
      <select formControlName="pacienteId">
        <option value="">Selecione</option>
        <option *ngFor="let p of pacientes" [value]="p.id">
          {{ p.nome }} ({{ p.id }})
        </option>
      </select>
    </label>
    <div *ngIf="form.get('pacienteId')?.invalid && form.get('pacienteId')?.touched" style="color: red;">
      Paciente é obrigatório
    </div>
  </div>

  <div>
    <label>Médicos:
      <select formControlName="medicos" multiple size="4">
        <option *ngFor="let m of medicosList" [value]="m.id">
          {{ m.nome }} - {{ m.crm }}
        </option>
      </select>
    </label>
    <div *ngIf="form.get('medicos')?.invalid && form.get('medicos')?.touched" style="color: red;">
      Pelo menos um médico é obrigatório
    </div>
  </div>

  <button type="submit" [disabled]="loading">
    {{ loading ? 'Salvando...' : 'Salvar' }}
  </button>
  <button type="button" (click)="cancelar()">Cancelar</button>
</form>
